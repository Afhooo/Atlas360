/* Apple-inspired Design System for Atlas Suite */

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== VARIABLES GLOBALES ===== */
:root {
  color-scheme: light;

  /* Fondo principal */
  --app-bg: #f5f5f7;
  --app-bg-strong: #fdfdfd;

  /* Colores del sistema */
  --app-foreground: #0a0f1a;
  --app-foreground-soft: rgba(10, 15, 26, 0.92);
  --app-muted: #3f4755;
  --app-border: rgba(14, 20, 32, 0.08);
  --app-border-strong: rgba(14, 20, 32, 0.14);
  --app-card: rgba(255, 255, 255, 0.9);
  --app-card-hover: rgba(255, 255, 255, 0.98);

  /* Efectos de cristal */
  --glass-bg: rgba(255, 255, 255, 0.9);
  --glass-card-bg: rgba(255, 255, 255, 0.98);
  --glass-border: rgba(15, 23, 42, 0.08);
  --glass-shadow: 0 18px 48px rgba(15, 23, 42, 0.08);

  /* Gradientes Apple */
  --gradient-primary: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
  --gradient-success: linear-gradient(135deg, #34d399 0%, #16a34a 100%);
  --gradient-warning: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
  --gradient-danger: linear-gradient(135deg, #f87171 0%, #ef4444 100%);

  /* Sombras contextuales */
  --shadow-primary: 0 18px 45px rgba(59, 130, 246, 0.25);
  --shadow-success: 0 18px 45px rgba(34, 197, 94, 0.22);
  --shadow-warning: 0 18px 45px rgba(249, 115, 22, 0.24);
  --shadow-danger: 0 18px 45px rgba(239, 68, 68, 0.24);

  /* Elementos interactivos */
  --selection-bg: rgba(59, 130, 246, 0.18);
  --selection-fg: #0f172a;
  --hover-surface: rgba(15, 23, 42, 0.06);
  --hover-surface-strong: rgba(15, 23, 42, 0.08);
  --toggle-bg: rgba(255, 255, 255, 0.8);
  --toggle-fg: #0f172a;
  --toggle-indicator-bg: rgba(255, 255, 255, 0.95);
  --toggle-indicator-border: rgba(15, 23, 42, 0.16);
  --scrollbar-track: rgba(15, 23, 42, 0.08);
  --scrollbar-thumb: rgba(15, 23, 42, 0.2);
  --scrollbar-thumb-hover: rgba(15, 23, 42, 0.3);
}

.dark {
  color-scheme: dark;

  --app-bg: #000000;
  --app-bg-strong: #0f172a;
  --app-foreground: #ffffff;
  --app-foreground-soft: rgba(255, 255, 255, 0.86);
  --app-muted: #6b7280;
  --app-border: rgba(255, 255, 255, 0.1);
  --app-border-strong: rgba(255, 255, 255, 0.18);
  --app-card: rgba(0, 0, 0, 0.6);
  --app-card-hover: rgba(0, 0, 0, 0.78);

  --glass-bg: rgba(17, 24, 39, 0.72);
  --glass-card-bg: rgba(17, 24, 39, 0.82);
  --glass-border: rgba(255, 255, 255, 0.1);
  --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);

  --gradient-primary: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
  --gradient-success: linear-gradient(135deg, #22c55e 0%, #15803d 100%);
  --gradient-warning: linear-gradient(135deg, #f97316 0%, #c2410c 100%);
  --gradient-danger: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%);

  --shadow-primary: 0 4px 18px rgba(59, 130, 246, 0.3);
  --shadow-success: 0 4px 18px rgba(34, 197, 94, 0.3);
  --shadow-warning: 0 4px 18px rgba(249, 115, 22, 0.3);
  --shadow-danger: 0 4px 18px rgba(239, 68, 68, 0.3);

  --selection-bg: rgba(59, 130, 246, 0.32);
  --selection-fg: rgba(226, 232, 240, 0.98);
  --hover-surface: rgba(255, 255, 255, 0.08);
  --hover-surface-strong: rgba(255, 255, 255, 0.12);
  --toggle-bg: rgba(255, 255, 255, 0.08);
  --toggle-fg: rgba(226, 232, 240, 0.86);
  --toggle-indicator-bg: rgba(10, 10, 10, 0.85);
  --toggle-indicator-border: rgba(255, 255, 255, 0.14);
  --scrollbar-track: rgba(255, 255, 255, 0.06);
  --scrollbar-thumb: rgba(255, 255, 255, 0.18);
  --scrollbar-thumb-hover: rgba(255, 255, 255, 0.26);
}

/* ===== BASE STYLES ===== */
html {
  height: 100%;
  scroll-behavior: smooth;
}

body {
  height: 100%;
  background: var(--app-bg);
  color: var(--app-foreground);
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 13px;
  line-height: 1.4;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
}

/* ===== LIGHT THEME ADAPTATIONS ===== */
html[data-theme='light'] .text-white { color: var(--app-foreground) !important; }
html[data-theme='light'] .text-white\/90 { color: rgba(16, 24, 40, 0.9) !important; }
html[data-theme='light'] .text-white\/80 { color: rgba(16, 24, 40, 0.8) !important; }
html[data-theme='light'] .text-white\/70 { color: rgba(16, 24, 40, 0.7) !important; }
html[data-theme='light'] .text-white\/60 { color: rgba(16, 24, 40, 0.6) !important; }
html[data-theme='light'] .text-white\/50 { color: rgba(16, 24, 40, 0.5) !important; }
html[data-theme='light'] .text-white\/40 { color: rgba(16, 24, 40, 0.4) !important; }
html[data-theme='light'] .bg-black { background-color: var(--app-bg-strong) !important; }
html[data-theme='light'] .bg-black\/20 { background-color: rgba(15, 23, 42, 0.05) !important; }
html[data-theme='light'] .bg-black\/30 { background-color: rgba(15, 23, 42, 0.06) !important; }
html[data-theme='light'] .bg-black\/40 { background-color: rgba(15, 23, 42, 0.08) !important; }
html[data-theme='light'] .bg-black\/50 { background-color: rgba(15, 23, 42, 0.1) !important; }
html[data-theme='light'] .bg-black\/60 { background-color: rgba(15, 23, 42, 0.12) !important; }
html[data-theme='light'] .bg-black\/80 { background-color: rgba(15, 23, 42, 0.18) !important; }
html[data-theme='light'] .bg-black\/90 { background-color: rgba(15, 23, 42, 0.24) !important; }
html[data-theme='light'] .bg-white\/5 { background-color: rgba(15, 23, 42, 0.04) !important; }
html[data-theme='light'] .bg-white\/8 { background-color: rgba(15, 23, 42, 0.05) !important; }
html[data-theme='light'] .bg-white\/10 { background-color: rgba(15, 23, 42, 0.06) !important; }
html[data-theme='light'] .bg-white\/15 { background-color: rgba(15, 23, 42, 0.08) !important; }
html[data-theme='light'] .bg-white\/20 { background-color: rgba(15, 23, 42, 0.12) !important; }
html[data-theme='light'] .bg-white\/30 { background-color: rgba(15, 23, 42, 0.16) !important; }
html[data-theme='light'] .border-white\/5 { border-color: rgba(15, 23, 42, 0.06) !important; }
html[data-theme='light'] .border-white\/10 { border-color: rgba(15, 23, 42, 0.08) !important; }
html[data-theme='light'] .border-white\/15 { border-color: rgba(15, 23, 42, 0.12) !important; }
html[data-theme='light'] .border-white\/20 { border-color: rgba(15, 23, 42, 0.16) !important; }
html[data-theme='light'] .border-white\/30 { border-color: rgba(15, 23, 42, 0.24) !important; }
html[data-theme='light'] .focus\:ring-offset-black { --tw-ring-offset-color: var(--app-bg); }
html[data-theme='light'] .focus\:ring-offset-black:focus { --tw-ring-offset-color: var(--app-bg); }
html[data-theme='light'] .focus\:ring-offset-black:focus-visible { --tw-ring-offset-color: var(--app-bg); }
html[data-theme='light'] .focus\:ring-offset-black:focus-within { --tw-ring-offset-color: var(--app-bg); }
html[data-theme='light'] .hover\:bg-white\/10:hover { background-color: var(--hover-surface) !important; }
html[data-theme='light'] .hover\:bg-white\/5:hover { background-color: var(--hover-surface) !important; }
html[data-theme='light'] .hover\:bg-white\/15:hover { background-color: var(--hover-surface-strong) !important; }
html[data-theme='light'] .hover\:bg-white\/20:hover { background-color: var(--hover-surface-strong) !important; }
html[data-theme='light'] .hover\:bg-white\/8:hover { background-color: var(--hover-surface) !important; }
html[data-theme='light'] .hover\:bg-white\/30:hover { background-color: var(--hover-surface-strong) !important; }
html[data-theme='light'] .hover\:bg-black:hover { background-color: var(--hover-surface-strong) !important; }
html[data-theme='light'] .hover\:bg-black\/60:hover { background-color: var(--hover-surface) !important; }

/* Light-mode cards y glass más planos y profesionales */
html[data-theme='light'] .glass {
  background: #ffffff !important;
  box-shadow: 0 2px 8px rgba(15, 23, 42, 0.04) !important;
}

html[data-theme='light'] .glass-card {
  border-radius: 12px !important;
  border-color: rgba(14, 20, 32, 0.08) !important;
  box-shadow: 0 1px 2px rgba(15, 23, 42, 0.04) !important;
}

html[data-theme='light'] .sidebar-shell {
  background: linear-gradient(180deg, #f5f7fb 0%, #eef2f7 100%) !important;
  box-shadow: inset -1px 0 0 rgba(14, 20, 32, 0.06);
}

/* ===== SCROLLBAR PERSONALIZADO ===== */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--scrollbar-track);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: var(--scrollbar-thumb);
  border-radius: 4px;
  transition: background 0.2s ease;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--scrollbar-thumb-hover);
}

/* ===== COMPONENTES BASE ===== */
@layer components {
  /* === CONTENEDORES === */
  .apple-container {
    @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8;
  }
  
  .apple-section {
    @apply mb-8;
  }
  
  /* === EFECTOS DE CRISTAL === */
  .glass {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    box-shadow: var(--glass-shadow);
  }
  
  .glass-panel {
    @apply glass rounded-apple;
  }
  
  .glass-card {
    @apply glass rounded-apple px-3 py-2.5 shadow-apple-sm;
  }
  
  /* === TARJETAS === */
  .card {
    @apply glass-card;
  }
  
  .card-compact {
    @apply glass rounded-apple p-apple-sm shadow-apple-sm;
  }
  
  .card-hover {
    @apply card transition-all duration-300 ease-apple hover:shadow-apple-lg hover:scale-[1.02] hover:-translate-y-1;
  }
  
  /* === TIPOGRAFÍA === */
  .apple-h1 {
    @apply font-semibold tracking-apple-tight text-white;
    font-size: 16px;
    line-height: 22px;
  }
  
  .apple-h2 {
    @apply font-semibold tracking-apple-normal text-white;
    font-size: 15px;
    line-height: 21px;
  }
  
  .apple-h3 {
    @apply font-medium tracking-apple-normal text-white;
    font-size: 14px;
    line-height: 20px;
  }
  
  .apple-body {
    @apply text-white;
    font-size: 13px;
    line-height: 19px;
  }
  
  .apple-caption {
    @apply text-app-muted;
    font-size: 11px;
    line-height: 16px;
    letter-spacing: 0.04em;
  }
  
  .apple-muted {
    color: var(--app-muted);
  }
  
  /* === BOTONES === */
  .btn {
    @apply inline-flex items-center justify-center px-3 py-1.5 rounded-apple text-apple-footnote font-medium transition-all duration-200 ease-apple select-none focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-black disabled:opacity-50 disabled:cursor-not-allowed;
  }
  
  .btn-primary {
    @apply btn bg-apple-blue-600 text-white hover:bg-apple-blue-700 focus:ring-apple-blue-500 shadow-apple-sm hover:shadow-primary active:scale-95;
  }
  
  .btn-secondary {
    @apply btn bg-white/10 text-white border border-white/20 hover:bg-white/15 hover:border-white/30 focus:ring-white/50 shadow-apple-sm;
  }
  
  .btn-success {
    @apply btn bg-apple-green-600 text-white hover:bg-apple-green-700 focus:ring-apple-green-500 shadow-apple-sm hover:shadow-success active:scale-95;
  }
  
  .btn-warning {
    @apply btn bg-apple-orange-600 text-white hover:bg-apple-orange-700 focus:ring-apple-orange-500 shadow-apple-sm hover:shadow-warning active:scale-95;
  }
  
  .btn-danger {
    @apply btn bg-apple-red-600 text-white hover:bg-apple-red-700 focus:ring-apple-red-500 shadow-apple-sm hover:shadow-danger active:scale-95;
  }
  
  .btn-ghost {
    @apply btn bg-transparent text-white hover:bg-white/10 focus:ring-white/50;
  }
  
  .btn-sm {
    @apply px-3 py-1.5 text-apple-footnote;
  }
  
  .btn-lg {
    @apply px-4 py-2 text-apple-body;
  }
  
  /* === CAMPOS DE ENTRADA === */
  .field {
    @apply w-full px-3 py-1.5 bg-white/5 border border-white/20 rounded-apple text-apple-footnote text-white placeholder-app-muted transition-all duration-200 ease-apple focus:outline-none focus:ring-2 focus:ring-apple-blue-500 focus:border-apple-blue-500 focus:bg-white/10;
  }
  
  .field-sm {
    @apply field px-2.5 py-1.5 text-apple-footnote;
  }
  
  .field-lg {
    @apply field px-4 py-3 text-apple-callout;
  }

  /* Estilo unificado Apple-like para inputs, selects y textareas */
  .input-apple {
    @apply w-full rounded-apple border border-white/15 bg-white/5 text-apple-footnote text-white px-3 py-1.5;
    @apply placeholder:text-apple-gray-500 focus:outline-none focus:ring-2 focus:ring-apple-blue-500 focus:border-apple-blue-500;
    @apply transition-all duration-200 ease-apple shadow-apple-sm;
    background-image: radial-gradient(circle at 0 0, rgba(255,255,255,0.18), transparent 55%);
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
  }

  .input-apple:focus {
    box-shadow: 0 0 0 1px rgba(59,130,246,0.6), 0 0 0 6px rgba(59,130,246,0.18);
    background-color: rgba(15,23,42,0.9);
  }

  /* Selects con caret custom al estilo Apple */
  select.input-apple {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    padding-right: 2.5rem;
    background-position: right 0.75rem center;
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-image: url("data:image/svg+xml,%3Csvg width='14' height='14' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5 7L10 12L15 7' stroke='%23A5B4FC' stroke-width='1.6' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
  }

  select.input-apple:focus {
    background-color: rgba(15,23,42,0.96);
  }
  
  /* === BADGES === */
  .badge {
    @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-apple-caption2 font-medium;
  }
  
  .badge-primary {
    @apply badge bg-apple-blue-600/20 text-apple-blue-300 border border-apple-blue-500/30;
  }
  
  .badge-success {
    @apply badge bg-apple-green-600/20 text-apple-green-300 border border-apple-green-500/30;
  }
  
  .badge-warning {
    @apply badge bg-apple-orange-600/20 text-apple-orange-300 border border-apple-orange-500/30;
  }
  
  .badge-danger {
    @apply badge bg-apple-red-600/20 text-apple-red-300 border border-apple-red-500/30;
  }
  
  .badge-neutral {
    @apply badge bg-white/10 text-white border border-white/20;
  }

  /* === PILLS (chips Apple-like) === */
  .pill {
    @apply inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-apple-caption2 font-medium border;
    @apply bg-white/5 border-white/10 text-apple-gray-200;
  }

  .pill-soft {
    @apply pill bg-white/8 border-white/15 text-white;
  }

  .pill-blue {
    @apply pill bg-apple-blue-500/15 border-apple-blue-400/40 text-apple-blue-100;
  }

  .pill-green {
    @apply pill bg-apple-green-500/15 border-apple-green-400/40 text-apple-green-100;
  }

  .pill-orange {
    @apply pill bg-apple-orange-500/15 border-apple-orange-400/40 text-apple-orange-100;
  }

  .pill-purple {
    @apply pill bg-purple-500/15 border-purple-400/40 text-purple-100;
  }
  
  /* === TABLAS === */
  .table-apple {
    @apply w-full text-apple-body;
    border-collapse: separate;
    border-spacing: 0;
  }
  
  .table-apple thead th {
    @apply px-4 py-3 text-left text-apple-caption1 font-semibold text-app-muted uppercase tracking-wider border-b border-white/10 bg-white/5;
  }
  
  .table-apple tbody tr {
    @apply border-b border-white/5 hover:bg-white/5 transition-colors duration-200;
  }
  
  .table-apple tbody td {
    @apply px-4 py-3 text-white;
  }
  
  /* === NAVEGACIÓN === */
  .nav-link {
    @apply flex items-center gap-3 px-3 py-2 rounded-apple text-apple-body font-medium transition-all duration-200 ease-apple;
  }
  
  .nav-link-active {
    @apply nav-link bg-apple-blue-600/20 text-apple-blue-300 border border-apple-blue-500/30;
  }
  
  .nav-link-inactive {
    @apply nav-link text-app-muted hover:text-white hover:bg-white/10;
  }
  
  /* === ALERTAS === */
  .alert {
    @apply p-4 rounded-apple border;
  }
  
  .alert-info {
    @apply alert bg-apple-blue-600/10 border-apple-blue-500/30 text-apple-blue-300;
  }
  
  .alert-success {
    @apply alert bg-apple-green-600/10 border-apple-green-500/30 text-apple-green-300;
  }
  
  .alert-warning {
    @apply alert bg-apple-orange-600/10 border-apple-orange-500/30 text-apple-orange-300;
  }
  
  .alert-danger {
    @apply alert bg-apple-red-600/10 border-apple-red-500/30 text-apple-red-300;
  }
  
  /* === DIVISORES === */
  .divider {
    @apply border-t border-white/10;
  }
  
  .divider-vertical {
    @apply border-l border-white/10;
  }
  
  /* === ANIMACIONES === */
  .animate-apple-fade-in {
    animation: appleFadeIn 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  
  .animate-apple-slide-up {
    animation: appleSlideUp 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  
  .animate-apple-scale {
    animation: appleScale 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  
  /* === UTILIDADES === */
  .text-balance {
    text-wrap: balance;
  }
  
  .backdrop-blur-apple {
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }
  
  .backdrop-blur-apple-sm {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }
  
  .backdrop-blur-apple-lg {
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
  }

  /* Sidebar shell corporativo: discreto y adaptable a tema */
  .sidebar-shell {
    @apply glass backdrop-blur-apple-lg border-r border-[color:var(--app-border)] dark:border-white/10 relative overflow-hidden;
    background: linear-gradient(
      to bottom,
      color-mix(in srgb, var(--app-bg-strong) 88%, #020617 12%),
      color-mix(in srgb, var(--app-bg-strong) 100%, #020617 0%)
    );
  }

  .sidebar-shell::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 0% 0%, rgba(148, 163, 184, 0.18), transparent 55%);
    opacity: 0.8;
    pointer-events: none;
  }

  .sidebar-shell::after {
    content: '';
    position: absolute;
    inset: auto 0 0;
    height: 32%;
    background: linear-gradient(to top, rgba(15,23,42,0.65), transparent);
    pointer-events: none;
  }
}

/* ===== LEAFLET OVERRIDES ===== */
@import "leaflet/dist/leaflet.css";

.leaflet-container {
  background: #111;
  border-radius: 12px;
  overflow: hidden;
}

.leaflet-container img,
.leaflet-container .leaflet-tile {
  max-width: none !important;
  image-rendering: auto;
  filter: none;
}

.leaflet-container .leaflet-tile {
  width: 256px !important;
  height: 256px !important;
}

/* ===== DESARROLLO - OCULTAR OVERLAYS ===== */
#nextjs-devtools,
#nextjs-portal,
#nextjs-toast,
[data-nextjs-overlay],
[data-nextjs-toast],
[data-nextjs-devtools] {
  pointer-events: none !important;
  z-index: 0 !important;
  display: none !important;
}

/* ===== RESPONSIVE UTILITIES ===== */
@media (max-width: 640px) {
  .apple-container {
    @apply px-4;
  }
  
  .card {
    @apply px-3 py-2.5;
  }
  
  .apple-h1 {
    @apply text-apple-title2;
  }
  
  .apple-h2 {
    @apply text-apple-body;
  }
}

/* ===== PRINT STYLES ===== */
@media print {
  .glass,
  .glass-panel,
  .glass-card,
  .card {
    background: white !important;
    color: black !important;
    border: 1px solid #e5e7eb !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
  }
  
  .btn {
    border: 1px solid #e5e7eb !important;
    background: white !important;
    color: black !important;
  }
}
